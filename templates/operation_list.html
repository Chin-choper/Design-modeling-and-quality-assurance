<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>Моніторинг ЗЕД</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }

        .tab {
            overflow: hidden;
            border: 1px solid #ccc;
            background-color: #f1f1f1;
            border-radius: 5px 5px 0 0;
        }
        .tab button {
            background-color: inherit;
            float: left;
            border: none;
            outline: none;
            cursor: pointer;
            padding: 10px 16px;
            transition: 0.3s;
            font-size: 14px;
            font-weight: bold;
            color: #555;
        }
        .tab button:hover { background-color: #ddd; }
        .tab button.active { background-color: #ccc; color: #000; }

        .tabcontent {
            display: none;
            padding: 20px;
            border: 1px solid #ccc;
            border-top: none;
            background-color: #fff;
        }

        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        
        .header-main { background-color: #f2f2f2; }
        .filter-form { background: #f9f9f9; padding: 15px; margin-bottom: 20px; border: 1px solid #ddd; border-radius: 5px; }
    </style>
</head>
<body>

    <h3>Система моніторингу експортно-імпортних операцій</h3>

    <form method="get" style="margin-bottom: 20px;">
        <label>Рік:</label>
        <select name="year">
            {% for y in years %}
            <option value="{{ y }}" {% if y == selected_year %}selected{% endif %}>{{ y }}</option>
            {% endfor %}
        </select>

        <label>Місяць:</label>
        <select name="month">
            {% for m in months %}
            <option value="{{ m.val }}" {% if m.val == selected_month %}selected{% endif %}>{{ m.name }}</option>
            {% endfor %}
        </select>

        <button type="submit">Показати</button>
    </form>

    <div class="tab">
        <button class="tablinks active" onclick="openTab(event, 'GeneralView')">Загальний огляд</button>
        <button class="tablinks" onclick="openTab(event, 'CountryView')">Аналіз ТОП-країн</button>
        <button class="tablinks" onclick="openTab(event, 'GoodsView')">Товари</button>
        <button class="tablinks" onclick="openTab(event, 'Prediction')">Прогноз 2023 року</button>
        <button class="tablinks" onclick="openTab(event, 'DniproSpec')">Дніпроспецсталь</button>
        <button class="tablinks" onclick="openTab(event, 'Zaporizhstal')">Запоріжсталь</button>
    </div>

    <div id="GeneralView" class="tabcontent" style="display: block;">
        <h4 style="color: #333;">Моніторинг за {{ selected_month }}.{{ selected_year }}</h4>
        <table>
            <tr class="header-main">
                <th>Країна-партнер</th>
                <th>Товарообіг (USD)</th>
                <th>Експорт (USD)</th>
                <th>Імпорт (USD)</th>
                <th>Сальдо (USD)</th>
                <th>Дата</th>
            </tr>
            {% for item in operations %}
            <tr>
                <td><b>{{ item.country }}</b></td>
                <td>{{ item.turnover }}</td>
                <td style="color: blue;">{{ item.export }}</td>
                <td style="color: green;">{{ item.import }}</td>
                <td>{{ item.balance }}</td>
                <td>{{ item.date }}</td>
            </tr>
            {% empty %}
            <tr><td colspan="6" style="text-align: center;">Файл не знайдено або він порожній</td></tr>
            {% endfor %}
        </table>
    </div>

    <div id="CountryView" class="tabcontent">
        <div style="display: flex; gap: 50px; flex-wrap: wrap;">
            <div style="min-width: 300px;">
                <h4 style="color: blue;">ТОП-5 Країн (Експорт)</h4>
                <table>
                    <tr class="header-main"><th>Країна</th><th>Сума</th></tr>
                    {% for item in top_export_countries %}
                    <tr><td><b>{{ item.country }}</b></td><td>{{ item.export_val }}</td></tr>
                    {% endfor %}
                </table>
            </div>
            <div style="min-width: 300px;">
                <h4 style="color: green;">ТОП-5 Країн (Імпорт)</h4>
                <table>
                    <tr class="header-main"><th>Країна</th><th>Сума</th></tr>
                    {% for item in top_import_countries %}
                    <tr><td><b>{{ item.country }}</b></td><td>{{ item.import_val }}</td></tr>
                    {% endfor %}
                </table>
            </div>
        </div>
    </div>

    <div id="GoodsView" class="tabcontent">
        <h4 style="color: #333;">Моніторинг за {{ selected_month }}.{{ selected_year }}</h4>
        <table>
            <tr class="header-main">
                <th>Група</th>
                <th>Товарообіг (USD)</th>
                <th>Експорт (USD)</th>
                <th>Імпорт (USD)</th>
                <th>Сальдо (USD)</th>
                <!--<th>Оподаткований імпорт, USD</th>
                <th>Надходження платежів від імпорту, USD</th>
                <th>Податкове навантаження</th>
                <th>Мито, USD</th>
                <th>Акцизний податок, USD</th>
                <th>ПДВ, USD</th>-->
                <th>Дата</th>
            </tr>
            {% for item in goods_operations %}
            <tr>
                <td><b>{{ item.product_goods }}</b></td>
                <td>{{ item.turnover_goods }}</td>
                <td style="color: blue;">{{ item.export_goods }}</td>
                <td style="color: green;">{{ item.import_goods }}</td>
                <td>{{ item.balance_goods }}</td>
                <td>{{ item.date }}</td>
            </tr>
            {% empty %}
            <tr><td colspan="6" style="text-align: center;">Файл не знайдено або він порожній</td></tr>
            {% endfor %}
        </table>
    </div>

    <div id="Prediction" class="tabcontent">
        <h4>Прогноз 2023 року</h4>
        <div style="text-align: center; margin-top: 20px;">
            {% if forecast_image %}
                <img src="/static/images/{{ forecast_image }}" alt="Графік прогнозу" style="max-width: 100%; border: 1px solid #ddd;">
            {% else %}
                <p>Дані відсутні або файл не створено.</p>
            {% endif %}
        </div>
    </div>

    <div id="DniproSpec" class="tabcontent">
        <h4>ПрАТ "Дніпроспецсталь"</h4>
        <table>
            <tr class="header-main"><th>Продукція</th><th>Сума</th><th>Дата</th></tr>
            {% for item in dnipro %}
            <tr><td>{{ item.category }}</td><td>{{ item.amount }} грн</td><td>{{ item.date }}</td></tr>
            {% empty %}<tr><td>Дані відсутні</td></tr>{% endfor %}
        </table>
    </div>

    <div id="Zaporizhstal" class="tabcontent">
        <h4>ПАТ "Запоріжсталь"</h4>
        <table>
            <tr class="header-main"><th>Продукція</th><th>Сума</th><th>Дата</th></tr>
            {% for item in zap_stal %}
            <tr><td>{{ item.category }}</td><td>{{ item.amount }} грн</td><td>{{ item.date }}</td></tr>
            {% empty %}<tr><td>Дані відсутні</td></tr>{% endfor %}
        </table>
    </div>

    <script>
        function openTab(evt, tabName) {
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) { tabcontent[i].style.display = "none"; }
            tablinks = document.getElementsByClassName("tablinks");
            for (i = 0; i < tablinks.length; i++) { tablinks[i].className = tablinks[i].className.replace(" active", ""); }
            document.getElementById(tabName).style.display = "block";
            evt.currentTarget.className += " active";
        }
    </script>
</body>
</html>
